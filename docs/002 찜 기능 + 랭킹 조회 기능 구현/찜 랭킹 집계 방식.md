# 찜 랭킹 집계 방식 (Agent B)

## 집계 기준

- 랭킹 키: `ranking:wishlist:popular` (Redis Sorted Set)
- 멤버가 상품 찜 추가 성공 시: 해당 상품 score `+1`
- 멤버가 상품 찜 해제 성공 시: 해당 상품 score `-1`
- score가 `0` 이하가 되면 ZSet에서 제거
- score는 "현재 찜 수"를 의미한다.

## 정확성 기준

- `(member_id, product_id)` 유니크 제약으로 중복 찜을 DB 레벨에서 차단
- 찜 추가 API는 멱등 처리
    - 이미 존재하면 no-op
    - 동시성 충돌로 유니크 위반이 나도 성공으로 처리(no-op)
- 랭킹 조회 시 상품 상태가 `ACTIVE`인 데이터만 응답에 포함

## 지연 시간 기준

- 찜/해제 시 랭킹 반영은 동기 처리(요청 트랜잭션 내 즉시 반영)
- 랭킹 조회는 Redis ZSet 상위 N건 조회(`ZREVRANGE WITHSCORES`)로 처리
- DB 전수 집계 없이 조회 가능하므로 요청 시점 계산 비용을 낮춘다.
